# GLWaterlevel-Analyst
This is an Open-Source Remote Sensing Toolbox situated in QGIS environment for Global Lake Water Level Analysis and Prediction. See below for how to install and use this toolbox .

**1. Installation of QGIS and the “Integrate Altimetry” plugin**

_(1)	Install QGIS 3.40_

QGIS is a full-featured, user-friendly, free-and-open-source (FOSS) geographical information system (GIS) that runs on Unix platforms, Windows, and MacOS. The “Integrate Altimetry” tool was developed to be utilized in the open-source software QGIS to enhance accessibility. To utilize the QGIS plugin, the QGIS software should be first installed.

  •	Install the QGIS from the website https://qgis.org/download/
  
  •	Choose the stable release (long-term version for Windows), instead of the latest version. The version of the QGIS used for this demonstration is “Long Term Version for Windows (3.40 LTR)”.
  
  <img width="359" height="167" alt="Picture1" src="https://github.com/user-attachments/assets/36a5508a-7c4e-4306-9a79-60a49aa6b2e2" />  
<br><br>

_(2)	Install the “Integrate Altimetry” plugin_

Depending on the version, the name of “Integrate Altimetry” could be different (e.g., Integrate_altimetry_6Func_8-16-2025). In the rest of this tutorial, we will use “Integrate Altimetry”. The default QGIS software does not include the “Integrate Altimetry” tool. To use this tool, the plugin folder should be manually added to the QGIS program folder.

•	Extract integrate_altimetry.zip as a folder “integrate_altimetry”.

•	Copy the folder “integrate_altimetry” to QGIS python **_plugins_** folder. If you use default settings when installing the QGIS, use the following folder path to paste the folder “integrate_altimetry”. If there is no plugins folder under the path, create one by yourself.

Path: C:\Users\YourUsername\AppData\Roaming\QGIS\QGIS3\profiles\default\python\plugins

Note: Depending on where you install the QGIS, the location could be different. 
<img width="495" height="297" alt="Picture2" src="https://github.com/user-attachments/assets/bfc0f4d5-1d93-41f2-bc4b-769d3ef40fcd" />

<img width="496" height="297" alt="Picture3" src="https://github.com/user-attachments/assets/6bf5a389-e8b5-49bc-946b-6881a4c84391" />

<br><br>
•	start QGIS. Then go to Plugins --> Manage and Install Plugins
 

•	In the pop-up window, click Installed, then check the tool “GLWaterLevel-Analyst”.
 
•	Immediately, there will be pop-up windows that ask you to install a series of necessary packages for this tool set. Click Yes for all of them.
      
*Once all packages are installed, you can click “No” when reopening the QGIS if there are still pop-up windows.
•	Once all packages are installed, close the Plugins window. Then the toolset is now added to the Plugins menu.
 
**2.** Use of the “Integrate Altimetry” plugin
1)	Set up the project folder
•	This plugin tool needs a shapefile of the target lake. The shapefile will be repetitively used in the following steps. In order to reduce the time of loading the shapefile, an optional tool, 0. Setup project folders (optional), is provided for setting up the project. After running the tool, a folder (e.g., LakeOkeechobee_WaterLevel_project) will be created under the Main Project Directory, which contains a series of folders that will be used to store the intermediate date generated by the following steps. 
  
 
The 01_downloaded_data will be used to store the data downloaded by the 1st tool.
The 02_filtered_elevation will be used to hold the output produced by the 2nd tool.
The 03_aggregated_tracks will be used to save the output from the 3rd tool.
The 04_bias_output and 05_timeSeries_output are used to save results from the 4th tool.
The 06_prediction_output will be used to save the predictions from the 5th tool.
In addition, after setting up this project folder, at each of the following steps, the corresponding data will be loaded automatically from these folders.

2)	Acquire altimetry data for target lake
•	Create an account for each of the platforms: NASA Earthdata Search and ESA Copernicus Data Space Ecosystem, if you do not have one before using the first tool. Jason-3 data product can be downloaded from NOAA NCEI ftp and needs no user account.

  
If you check the box “Save Info”, next time when you run this tool, you do not need to enter your credentials for the NASA EarthData Search and Copernicus Data Space Ecosystem.
Also, if you’ve set up the main project folder, the lake shapefile and the output folder will be entered automatically. Otherwise, you will need to load the shapefile and navigate to the place where you would like to save the data.
•	To check the satellite radar altimeters overpass of target lakes, use pass-locator from AVISO or OpenADB.
o	https://www.aviso.altimetry.fr/en/data/tools/pass-locator.html
o	https://openadb.dgfi.tum.de/en/passlocator/
Note that the satellite altimetry data are downloaded from NASA Earth Data Search (https://search.earthdata.nasa.gov/search), ESA Copernicus Data Space Ecosystem (https://browser.dataspace.copernicus.eu/), and NOAA National Center for Environmental Information (https://www.ncei.noaa.gov/products/jason-satellite-products). Sentinel-3A and 3B data products are available on Copernicus Data Space Ecosystem. Sentinel-6A and SWOT data products are available on NASA Earth Data Search.
3)	Filter and compute surface elevation for altimetry tracks
Use the second tool to process profiling radar altimetry data, such as filtering outliers and calculating orthometric heights.
•	The inward buffer is for excluding the profiling altimetry measurements close to lake shores. Distance of inward buffer cannot be larger than that of the narrowest width of the lake.
•	The MAD score is calculated for each elevation profile collected in one satellite overpass over the target lake. 
•	You can leave Min and Max by default (Min:0.0 m, Max 0.0 m) or specify the range of water surface elevation to further filter outliers. Here are some links you can check the water levels.
o	https://dahiti.dgfi.tum.de/en/products/water-level-altimetry/
o	https://ipad.fas.usda.gov/cropexplorer/global_reservoir/
o	https://www.lakesonline.com/
o	http://bluemesa.lakesonline.com/Level/
   
Note: if you’ve set up the main project folder, the interface will be filled up automatically.

4)	Spatially aggregate altimetry track data with SWOT
Use the third tool to aggregate both profiling altimetry data and SWOT swath data to the same grid layer. The grid cells will be created for the lake only.
•	Aggregation cell size: You can specify the grid cell size. Usually 1 – 2 km should be good. For really large lakes, 3 km can be used. The SWOT swath data has a resolution of 250 m. For most of the radar altimetry mission, the distance between two adjacent measurements is about 250 – 300m. Therefore, it will be better for the appropriate aggregation cell size to be larger than that (e.g., 1 km).
•	For each grid cell, there could be multiple altimetry measurements, you can specify median or mean of these measurements as the water level for the cell.
   
Note: if you’ve set up the main project folder, the interface will be filled up automatically.

5)	Integrate altimetry data for frequent water level records
Use the fourth tool to estimate the inter-mission biases between SWOT and the other radar altimetry missions, then combine them together to create a frequent time series of water levels.
•	The grid cells serve as the basic units for estimating biases between SWOT and the other satellite radar altimetry missions. The inter-mission biases are estimated based on the along-track grid cells that were overpassed concurrently (i.e., in the same day) by the SWOT and the profiling mission.
•	For each along-track grid cell overpassed by the profiling mission, the time series of water levels collected by the profiling mission is compared to the time series of SWOT-derived water levels to identify their concurrent water level pairs.
•	For each pair, the SWOT-derived water level is subtracted from the water level from the profiling mission. The difference of this water level pair is then recorded for this along-track grid cell.
•	For each ground track of each profiling mission, the median of the concurrent water level differences obtained from all the grid cells along the mission ground track is then used as the bias between the profiling mission and the SWOT for the ground track.
•	You can choose to estimate one bias for the whole mission or a bias for each of the ground tracks (if the mission has multiple tracks on this lake).
 
•	Again, if you’ve set up the main project folder, the interface will be filled up automatically.
•	You can choose whether to display the water level time series
•	The resulted water levels will be saved as a csv file named as “alt_swot_integrated_waterLevels.csv” in the 5th folder.

6)	Predict short-term water levels for the target lake
GLWaterlevel-Analyst includes a forecasting module that predicts near-future lake water levels, from days to several months ahead, based on the harmonized altimetry-derived time series. 
•	The tool provides two statistical methods for forecasting the water levels in the near future, including the Seasonal Auto-Regressive Integrated Moving Average (SARIMA) and Facebook’s Prophet model.
•	You can specify the number of days for the forecasting.
•	You can choose whether to display the predicted water levels
•	The forecast result will be saved in the 6th folder, with the name as “predicted_time_series_Prophet.csv” or “predicted_time_series_SARIMA.csv”
 
Note: The Prophet may not work well in QGIS python environment. You may encounter the following error prompt “RuntimeError: Error during optimization!”.
 
In this case, you will need to copy the “tdd.dll” file from the path below
C:\Program Files\QGIS 3.34.14\apps\Python312\Lib\site-packages\prophet\stan_model\cmdstan-2.33.1\stan\lib\stan_math\lib\tbb
To the path below
C:\Program Files\QGIS 3.34.14\apps\Python312\Lib\site-packages\prophet\stan_model\

